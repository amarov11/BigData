index=windows source="XmlWinEventLog:System" AND  
(EventCode=7040 service="Print Spooler" param2="auto start") OR  
(EventCode=7036 AND param2=running AND service="Print Spooler") 
| eval severity="medium"
|table dvc_nt_host,UserID,service,severity,param2


index=windows source="XmlWinEventLog:System" AND (EventCode=7040 service="Print Spooler" param2="auto start") OR  
(EventCode=7036 AND param2=running AND service="Print Spooler") dvc_nt_host IN ("SGA-DCPM001","SGA-DCPM002")
| eval severity="medium" 
| rename dvc_nt_host AS dvc 
| table dvc,UserID,service,severity,param2


index="windows" AND EventCode=4688 AND parent_process="*PSEXE*"
| eval severity="medium" 
| table src_user dvc_nt_host parent_process Process_Command_Line severity


index="windows" AND EventCode=4688 AND parent_process="*PSEXE*" AND dvc_nt_host IN ("SGA-DCPM001","SGA-DCPM002","SGA-DCPM003")
| eval severity="medium" 
| rename TargetUserName as src_user
| rename dvc_nt_host as dvc
| table src_user dvc parent_process Process_Command_Line severity


index=windows EventCode=4688 AND process_name="setspn.exe"
| eval severity="medium"
| rename dvc_nt_host as dvc, SubjectUserName as user
| table dvc user severity process_name


index=windows AND EventCode=4657 ObjectValueName=DisablePasswordChange NewValue=1 source="XmlWinEventLog:Security" dvc_nt_host IN ("WIN-SATJ7KSGAVM","machine") 
| eval severity="medium" 
| rename SubjectUserName AS user, dvc_nt_host AS dvc
| table dvc user ObjectValueName NewValue


index=windows AND source="XmlWinEventLog:Security"AND EventCode=4662  dvc_nt_host IN ("WIN-SATJ7KSGAVM","machine")   ObjectName="%{e9748722-25dd-41df-bcbe-6d713d7e7843}" 
| eval severity="medium" 
| eval Object_Name=case
( like(ObjectName, "%{e9748722-25dd-41df-bcbe-6d713d7e7843}"), "AdminSDHolder")
| rename dvc_nt_host AS dvc, TargetUserName AS user
| table dvc src_user Object_Name



index=windows AND source="XmlWinEventLog:Security" AND EventCode=5136 AND AttributeLDAPDisplayName=dSHeuristics dvc_nt_host IN ("WIN-SATJ7KSGAVM","XX")
|eval severity="medium"
| rename dvc_nt_host AS dvc, src_user AS user
| table dvc user AttributeLDAPDisplayName




index=windows AND source="XmlWinEventLog:Security" AND EventCode=  4719 AND dvc_nt_host IN ("WIN-SATJ7KSGAVM","XX")
|eval severity="Medium"
| rename dvc_nt_host AS dvc, src_user AS user
| table dvc user, severity




index=windows AND source="XmlWinEventLog:Security" AND EventCode= 4657 AND (ObjectName = *Run* OR ObjectName = *RunOnce*) AND name="A registry value was modified" AND dvc_nt_host IN ("WIN-SATJ7KSGAVM","")
| eval severity = High
| rename dvc_nt_host AS dvc,SubjectUserName AS user 
| table dvc user ObjectValueName NewValue severity


index=windows AND source="XmlWinEventLog:Security" AND EventCode= 4663 AND file_path="*Programs\\Startup*"
| regex object_file_name=".*\.(exe|bat|cmd|ps1|vbs|js|py|reg|wsf|sh)$" 
| eval severity = High
| rename dvc_nt_host AS dvc, src_user AS user
| table dvc user object_file_name

Attackers use the Startup Folder for persistence by placing files that execute automatically at each user logon. This ensures malicious programs run every time the system starts, maintaining access.



index=windows AND source=XmlWinEventLog:Microsoft-Windows-PowerShell/Operational AND (( EventCode=4103 AND Payload=*Get-ChildItem* AND Payload =*Hidden*) OR (EventCode=4104 AND ScriptBlockText=*ShowSuperHidden*))
| eval severity="Medium"
| rename dvc_nt_host AS dvc
| table dvc Payload ScriptBlockText


Adversaries use hidden files and directories to evade detection, marking files with hidden attributes or creating concealed folders. This tactic keeps malicious components undetected, aiding persistence on the system



index=windows AND EventCode=4688 AND (parent_process_name="nc.exe" OR parent_process_name="nc64.exe" OR parent_process_name="netcat.exe" OR parent_process_name="ncat.exe")
| eval severity="high"
| rename dvc_nt_host AS dvc
| table dvc user parent_process_name

C2 Non-Application Layer Protocol refers to using tools like Netcat to create covert communication channels. Detection focuses on monitoring process creation and command-line arguments for unusual network activity
